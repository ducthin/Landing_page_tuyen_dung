#!/bin/bash

echo "📋 HƯỚNG DẪN TEST ỨNG DỤNG CHẠY TRỰC TIẾP TRÊN VPS"
echo "=================================================="
echo ""
echo "🎯 MUC ĐÍCH:"
echo "   Kiểm tra xem Gmail SMTP có hoạt động khi ứng dụng Spring Boot"
echo "   chạy trực tiếp trên VPS (không qua Docker container)"
echo ""
echo "📝 CÁC BƯỚC THỰC HIỆN:"
echo ""
echo "1️⃣ CHUẨN BỊ:"
echo "   - Đảm bảo file .env có đầy đủ thông tin Gmail"
echo "   - Kiểm tra Gmail app password và 2FA đã bật"
echo ""
echo "2️⃣ CHẠY TEST (trên VPS):"
echo "   # Bước 1: Upload scripts lên VPS"
echo "   scp test-direct-run.sh test-email-direct.sh cleanup-direct-test.sh user@your-vps:~/recruitment-app/"
echo ""
echo "   # Bước 2: SSH vào VPS"
echo "   ssh user@your-vps"
echo "   cd ~/recruitment-app"
echo ""
echo "   # Bước 3: Cấp quyền cho scripts"
echo "   chmod +x test-direct-run.sh test-email-direct.sh cleanup-direct-test.sh"
echo ""
echo "   # Bước 4: Chạy test (Terminal 1)"
echo "   ./test-direct-run.sh"
echo ""
echo "   # Bước 5: Test email (Terminal 2 - SSH mới)"
echo "   ssh user@your-vps"
echo "   cd ~/recruitment-app"
echo "   ./test-email-direct.sh"
echo ""
echo "   # Bước 6: Dọn dẹp sau test"
echo "   ./cleanup-direct-test.sh"
echo ""
echo "🔍 ĐIỀU KIỆN KIỂM TRA:"
echo "   ✅ App build thành công"
echo "   ✅ Kết nối MySQL OK"
echo "   ✅ App start trên port 8080"
echo "   ✅ Email config load đúng"
echo "   ✅ Test email gửi thành công"
echo ""
echo "📧 KẾT QUẢ MONG MUỐN:"
echo "   - Nếu email GỬI THÀNH CÔNG → Vấn đề ở Docker environment"
echo "   - Nếu email VẪN LỖI → Vấn đề ở Gmail/VPS/network"
echo ""
echo "🔧 NẾU VẪN LỖI, THỬ:"
echo "   1. Tạo Gmail account mới với app password mới"
echo "   2. Chuyển sang Outlook SMTP"
echo "   3. Sử dụng SendGrid/Mailgun"
echo ""
echo "📞 DEBUG COMMANDS:"
echo "   # Kiểm tra app logs khi đang chạy"
echo "   tail -f nohup.out"
echo ""
echo "   # Test SMTP manual"
echo "   telnet smtp.gmail.com 587"
echo ""
echo "   # Kiểm tra port"
echo "   netstat -tlnp | grep 8080"
echo ""
echo "🚨 LƯU Ý:"
echo "   - Script sẽ dừng Docker containers để tránh xung đột port"
echo "   - Sau test nhớ chạy cleanup để khôi phục containers"
echo "   - App chạy trực tiếp sẽ dùng port 8080"
echo "   - Không expose ra internet, chỉ test local trên VPS"
